<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="management.student.repository.StudentRepository">

  <!-- SQLフラグメント -->
  <sql id="BaseColumnList">
    name, furigana, nickname, age, phone_number, gender, remarks, email, region
  </sql>

  <!-- 受講生登録 -->
  <insert id="createStudent" parameterType="management.student.data.Student" useGeneratedKeys="true"
    keyProperty="id">
    INSERT INTO student (
    <include refid="BaseColumnList"/>
    ) VALUES (
    #{name},
    #{furigana},
    #{nickname},
    #{age},
    #{phoneNumber},
    #{gender},
    #{remarks},
    #{email},
    #{region}
    )
  </insert>

  <!-- 受講生コース登録 -->
  <insert id="createStudentCourse" parameterType="management.student.data.StudentCourses">
    INSERT INTO student_courses (
    student_id,
    course_name,
    start_date,
    end_date
    ) VALUES (
    #{studentId},
    #{courseName},
    CURRENT_TIMESTAMP(),
    DATE_ADD(CURRENT_TIMESTAMP(), INTERVAL 1 YEAR)
    )
  </insert>

  <!-- 受講生更新 -->
  <update id="updateStudent" parameterType="management.student.data.Student">
    UPDATE student
    SET
    name = #{name},
    furigana = #{furigana},
    nickname = #{nickname},
    age = #{age},
    phone_number = #{phoneNumber},
    gender = #{gender},
    remarks = #{remarks},
    email = #{email},
    region = #{region}
    WHERE id = #{id}
  </update>

  <update id="updateStudentCourses" parameterType="management.student.data.StudentCourses">
    UPDATE student_courses
    SET
    course_name = #{courseName}
    WHERE id = #{id}
  </update>


</mapper>
